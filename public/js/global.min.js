!function(a){a.admin=a.admin||{version:"v1.0.0"},a.ajaxSetup({headers:{"X-CSRF-TOKEN":a('meta[name="csrf-token"]').attr("content")}}),a.admin.reloadCaptchaCode=function(){var t=a("#captcha_code_img");t.attr("src",t.attr("src").replace(/_=(.*)/i,"_="+Math.random()))},a.admin.ajaxCallback=function(t){200===t.code?(a.admin.notify(t.msg,"success"),"undefined"!=typeof ajaxSuccessCallback&&ajaxSuccessCallback instanceof Function&&ajaxSuccessCallback(t)):(a.admin.notify(t.msg,"error"),"undefined"!=typeof ajaxFailCallback&&ajaxFailCallback instanceof Function&&ajaxFailCallback(t)),"tips"===t.type?a.admin.afterResponse(t):window.setTimeout(function(){a.admin.afterResponse(t)},1500)},a.admin.afterResponse=function(t){"reload"===t.type?window.location.reload():"redirect"===t.type?window.location.href=t.url:"reload_captcha_code"===t.type?(a.admin.reloadCaptchaCode(),a("#captcha_code").val("")):"back"===t.type?window.history.go(-1):"tips"===t.type&&swal({title:t.data.title,text:t.data.msg,type:t.data.type,showCancelButton:!1,confirmButtonColor:"#ED5565",confirmButtonText:"确定",closeOnConfirm:!0},function(){""!==t.url&&(window.location.href=t.url)})},a.admin.ajaxGet=function(t,n){n=n||function(){},a.ajax({url:t,type:"get",dataType:"json",success:n})},a("body").delegate("a[data-pjax-request]","click",function(){var t=a(this).attr("data-href");a("#modal-pjax-content").html(""),a.ajax({url:t,type:"get",dataType:"html",success:function(t){try{200!=(t=JSON.parse(t)).code&&a.admin.notify(t.msg,"error")}catch(n){a("#modal-pjax").modal("show"),a("#modal-pjax-content").html(t)}},error:function(t){a("#modal-pjax-content").html(t.responseText)}})}),a("body").delegate("form[data-pjax-form]","submit",function(){var t=a(this),n=a('[data-id="'+t.attr("id")+'"]'),e=function(t){try{200!=(t=JSON.parse(t)).code&&a.admin.notify(t.msg,"error")}catch(n){a("#modal-pjax").modal("show"),a("#modal-pjax-content").html(t)}};return"file"===t.attr("data-submit-type")?a.admin.pjaxFileForm(t,n,e):a.admin.pjaxTextForm(t,n,e),!1}),a("body").delegate("a[data-ajax-get]","click",function(){var t=a(this).attr("href");return a.admin.ajaxGet(t,function(t){a.admin.ajaxCallback(t)}),!1}),a("body").delegate("form[data-ajax-form]","submit",function(){var t=a(this),n=a('[data-id="'+t.attr("id")+'"]');return"file"===t.attr("data-submit-type")?a.admin.ajaxFileForm(t,n,function(t){a.admin.ajaxCallback(t)}):a.admin.ajaxTextForm(t,n,function(t){a.admin.ajaxCallback(t)}),!1}),a.admin.ajaxFileForm=function(t,n,e){var o=t.get(0),i=new FormData(o);e=e||function(){},a.ajax({url:t.attr("action"),type:o.method||"POST",data:i,dataType:"json",contentType:!1,processData:!1,context:t,beforeSend:function(){n.button("loading"),n.prepend('<i class="fa fa-spinner fa-spin"></i> ')},error:function(){},success:e}).always(function(){window.setTimeout(function(){n.button("reset"),n.find("i.fa").remove()},1500)})},a.admin.ajaxTextForm=function(t,n,e){var o=t.get(0);e=e||function(){},a.ajax({url:t.attr("action"),type:o.method||"POST",data:t.serializeArray(),dataType:"json",context:t,beforeSend:function(){n.button("loading"),n.prepend('<i class="fa fa-spinner fa-spin"></i> ')},error:function(){},success:e}).always(function(){window.setTimeout(function(){n.button("reset"),n.find("i.fa").remove()},1500)})},a.admin.pjaxFileForm=function(t,n,e){var o=t.get(0),i=new FormData(o);e=e||function(){},a.ajax({url:t.attr("action"),type:o.method||"POST",data:i,headers:{"X-PJAX":!0},dataType:"html",contentType:!1,processData:!1,context:t,beforeSend:function(){n.button("loading"),n.prepend('<i class="fa fa-spinner fa-spin"></i> ')},error:function(){},success:e}).always(function(){window.setTimeout(function(){n.button("reset"),n.find("i.fa").remove()},1500)})},a.admin.pjaxTextForm=function(t,n,e){var o=t.get(0);e=e||function(){},a.ajax({url:t.attr("action"),type:o.method||"POST",data:t.serializeArray(),headers:{"X-PJAX":!0},dataType:"html",context:t,beforeSend:function(){n.button("loading"),n.prepend('<i class="fa fa-spinner fa-spin"></i> ')},error:function(){},success:e})},a.admin.tipBeforeAjax=function(t,n,e,o){swal({title:n,text:e,type:o,showCancelButton:!0,cancelButtonText:"取消",confirmButtonColor:"#ED5565",confirmButtonText:"确定",closeOnConfirm:!0},function(){a.admin.ajaxGet(t,function(t){a.admin.ajaxCallback(t)})})},a.admin.notify=function(a,t){toastr.options={debug:!1,preventDuplicates:!1,positionClass:"toast-top-full-width",onclick:null,showDuration:"400",hideDuration:"1000",timeOut:"1500",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},toastr[t](a)},a.admin.summernoteConfig={toolbar:[["style",["bold","italic","underline","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["picture","link","table","hr"]],["misc",["codeview","undo","redo"]]],height:250,callbacks:{onInit:function(){var t=a(this).attr("id"),n=a('input[name="'+t+'"]').val();a(this).summernote("code",n)},onImageUpload:function(t){for(var n=t.length-1;n>=0;n--)a.admin.sendFile(t[n],a(this))},onBlur:function(){var t=a(this).attr("id");a('input[name="'+t+'"]').val(a(this).summernote("code"))}}},a.admin.sendFile=function(t,n){var e=new FormData;e.append("file",t),a.ajax({data:e,type:"POST",url:n.attr("data-url"),contentType:!1,processData:!1,success:function(a){200===a.code&&n.summernote("insertImage",a.data.url,"")}})},a.admin.preAction=function(t,n,e){"notify"===t&&a.admin.notify(n,e)}}(jQuery);